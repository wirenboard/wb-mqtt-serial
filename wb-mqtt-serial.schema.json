{
  "type": "object",
  "title": "Serial Device Driver Configuration",
  "description": "Configuration of devices connected to serial ports (RS-485, TCP, UART)",

  "definitions": {
    "commonPortSettings": {
      "properties": {
        "enabled": {
          "type": "boolean",
          "title": "Enable port",
          "default": true,
          "_format": "checkbox",
          "propertyOrder": 2,
          "options": {
            "grid_columns": 12
          }
        },
        "response_timeout_ms": {
          "type": "integer",
          "title": "Response timeout (ms)",
          "description": "Zero means no timeout. If not set, the default timeout (500ms) is used.",
          "minimum": 0,
          "default": 500,
          "propertyOrder": 8,
          "options": {
            "grid_columns": 4
          }
        },
        "guard_interval_us": {
          "type": "integer",
          "title": "Guard interval (us)",
          "description": "guard_interval_description",
          "minimum": 0,
          "default": 0,
          "propertyOrder": 9,
          "options": {
            "grid_columns": 4
          }
        },
        "poll_interval": {
          "type": "integer",
          "options": {
            "hidden": true
          }
        },
        "read_rate_limit_ms": {
          "type": "integer",
          "title": "Read rate limit (ms)",
          "description" : "read_rate_limit_description",
          "minimum": 0,
          "default": 1000,
          "propertyOrder": 10
        },
        "devices": {
          "type": "array",
          "title": "Devices attached to the port",
          "items": { "$ref": "#/definitions/device" },
          "propertyOrder": 11,
          "options": {
            "array_controls_top": true,
            "disable_array_delete_last_row": true,
            "disable_array_reorder": true,
            "disable_collapse": true,
            "wb": {
              "disable_panel": true
            }
          },
          "_format": "collapsible-list"
        }
      }
    },
    "serialPort": {
      "title": "Serial port",
      "type": "object",
      "allOf": [
        {
          "properties": {
            "port_type": {
              "type": "string",
              "title": "Port type",
              "enum": ["serial"],
              "default": "serial",
              "propertyOrder": 1,
              "options": {
                "hidden": true
              }
            },
            "path": {
              "type": "string",
              "title": "Path to device",
              "minLength": 1,
              "propertyOrder": 3,
              "options": {
                "grid_columns": 4
              }    
            },
            "baud_rate": {
              "type": "integer",
              "title": "Baud rate",
              "enum": [110, 300, 600, 1200, 2400, 4800, 9600, 19200, 38400, 57600, 115200],
              "default": 9600,
              "propertyOrder": 4,
              "options": {
                "grid_columns": 2
              }    
            },
            "parity": {
              "type": "string",
              "title": "Parity",
              "enum": ["N", "E", "O"],
              "default": "N",
              "propertyOrder": 5,
              "options": {
                "grid_columns": 2
              }    
            },
            "data_bits": {
              "type": "integer",
              "title": "Data bits",
              "enum": [5, 6, 7, 8],
              "default": 8,
              "propertyOrder": 6,
              "options": {
                "grid_columns": 2
              }    
            },
            "stop_bits": {
              "type": "integer",
              "title": "Stop bits",
              "enum": [1, 2],
              "default": 1,
              "propertyOrder": 7,
              "options": {
                "grid_columns": 2
              }    
            }
          },
          "required": ["path"]
        },
        { "$ref" : "#/definitions/commonPortSettings"}
      ],
      "defaultProperties": ["port_type", "path", "baud_rate", "parity", "data_bits", "stop_bits", "devices"],
      "_format": "grid",
      "options": {
        "wb": {
          "disable_panel": true
        }
      }
    },
    "commonTcpPortSettings": {
      "properties": {
        "address": {
          "type": "string",
          "title": "IPv4 address or hostname of device",
          "minLength": 1,
          "propertyOrder": 3,
          "options": {
            "grid_columns": 10
          }
        },
        "port": {
          "type": "integer",
          "title": "TCP port number",
          "minimum": 1,
          "maximum": 65536,
          "propertyOrder": 4,
          "options": {
            "grid_columns": 2
          }
        },
        "connection_timeout_ms": {
          "type": "integer",
          "title": "Connection timeout (ms)",
          "description": "connection_timeout_description",
          "minimum": -1,
          "default": 5000,
          "propertyOrder": 5
        },
        "connection_max_fail_cycles": {
          "type": "integer",
          "title": "Connection max fail cycles",
          "description": "Defines number of driver cycles with all devices being disconnected before resetting connection. Default value is 2. Value -1 disables TCP reconnect. Zero means instant timeout.",
          "minimum": -1,
          "default": 2,
          "propertyOrder": 6
        }
      },
      "required": ["address", "port"]
    },
    "modbusTcpPort": {
      "title": "MODBUS TCP",
      "type": "object",
      "properties": {
        "port_type": {
          "type": "string",
          "title": "Port type",
          "enum": ["modbus tcp"],
          "default": "modbus tcp",
          "propertyOrder": 1,
          "options": {
            "hidden": true
          }
        }
      },
      "required": ["port_type"],
      "allOf": [
        { "$ref" : "#/definitions/commonTcpPortSettings"},
        { "$ref" : "#/definitions/commonPortSettings"}
      ],
      "defaultProperties": ["port_type", "address", "port", "enabled", "devices"],
      "_format": "grid",
      "options": {
        "wb": {
          "disable_panel": true
        }
      }
    },
    "tcpPort": {
      "title": "Serial over TCP",
      "type": "object",
      "properties": {
        "port_type": {
          "type": "string",
          "title": "Port type",
          "enum": ["tcp"],
          "default": "tcp",
          "propertyOrder": 1,
          "options": {
            "hidden": true
          }
        }
      },
      "required": ["port_type"],
      "allOf": [
        { "$ref" : "#/definitions/commonTcpPortSettings"},
        { "$ref" : "#/definitions/commonPortSettings"}
      ],
      "defaultProperties": ["port_type", "address", "port", "enabled", "devices"],
      "_format": "grid",
      "options": {
        "wb": {
          "disable_panel": true
        }
      }
    },
    "port": {
      "headerTemplate": "port_header_template",
      "title": "Port",
      "oneOf": [
        { "$ref": "#/definitions/serialPort" },
        { "$ref": "#/definitions/tcpPort" },
        { "$ref": "#/definitions/modbusTcpPort" }
      ],
      "options": {
        "keep_oneof_values": false,
        "disable_collapse" : true,
        "disable_edit_json": true
      },
      "_format": "wb-multiple"
    },
    "slave_id_ui": {
      "properties": {
        "slave_id": {
          "title": "Slave id of the device",
          "propertyOrder": 2,
          "type": "string",
          "pattern": "^(0x[A-Fa-f\\d]+|\\d+|(0x[A-Fa-f\\d]+|\\d+):(0x[A-Fa-f\\d]+|\\d+))$",
          "options": {
            "inputAttributes": {
              "placeholder":  "decimal (e.g. 123) or hex (e.g. 0xAF)"
            },
            "patternmessage": "Should be decimal or hex"
          }
        }
      }
    },
    "slave_id": {
      "properties": {
        "slave_id": {
          "oneOf": [
            {
              "type": "string",
              "pattern": "^(0x[A-Fa-f\\d]+|\\d+|(0x[A-Fa-f\\d]+|\\d+):(0x[A-Fa-f\\d]+|\\d+))$"
            },
            {
              "type": "integer"
            }
          ]
        }
      }
    },
    "slave_id_broadcast": {
      "properties": {
        "slave_id": {
          "oneOf": [
            {
              "type": "string",
              "pattern": "^(0x[A-Fa-f\\d]+|\\d+)$"
            },
            {
              "type": "integer"
            },
            {
              "type": "boolean",
              "enum": [ false ],
              "default": false
            }
          ]
        }
      }
    },
    "slave_id_broadcast_ui": {
      "properties": {
        "slave_id": {
          "title": "Slave id of the device or broadcast mode",
          "propertyOrder": 2,
          "oneOf": [
            {
              "title": "decimal or hex slave id",
              "type": "string",
              "pattern": "^(0x[A-Fa-f\\d]+|\\d+)$",
              "options": {
                "inputAttributes": {
                  "placeholder":  "decimal (e.g. 123) or hex (e.g. 0xAF)"
                },
                "patternmessage": "Should be decimal or hex"
              }
            },
            {
              "title": "broadcast",
              "type": "boolean",
              "enum": [ false ],
              "default": false,
              "readOnly": true,
              "options": {
                "enum_titles": ["broadcast_description"]
              }
            }
          ],
          "options": {
            "keep_oneof_values": false
          }
        }
      }
    },
    "device_name": {
      "description" : "Device name to be displayed in UI",
      "minLength" : 1,
      "type" : "string"
    },
    "deviceProperties": {
      "properties": {
        "enabled": {
          "type": "boolean",
          "title": "Enable device",
          "default": true,
          "_format": "checkbox",
          "propertyOrder": 1
        },
        "name" : {
          "$ref" : "#/definitions/device_name",
          "title" : "Device name",
          "propertyOrder": 3
        },
        "id": {
          "type": "string",
          "title": "MQTT id of the device",
          "description": "Used as part of the topic",
          "minLength": 1,
          "propertyOrder": 4
        },
        "poll_interval": {
          "type": "integer",
          "options": {
            "hidden": true
          }
        },
        "read_rate_limit_ms": {
          "type": "integer",
          "title": "Read rate limit (ms)",
          "description" : "read_rate_limit_description",
          "minimum": 0,
          "default": 1000,
          "propertyOrder": 5
        },
        "password": {
          "type": "array",
          "title": "Password as a list of bytes",
          "items": { "$ref": "#/definitions/serial_int" },
          "_format": "table",
          "propertyOrder": 101,
          "options": {
            "disable_array_delete_last_row": true
          }
        },
        "access_level": {
          "type": "integer",
          "title": "Access level",
          "minimum": 0,
          "maximum": 2,
          "default": 1,
          "propertyOrder": 102
        },
        "max_reg_hole": {
          "type": "integer",
          "title": "Max dummy read register count",
          "minimum": 0,
          "default": 0,
          "propertyOrder": 103
        },
        "max_bit_hole": {
          "type": "integer",
          "title": "Max dummy read bit count",
          "minimum": 0,
          "default": 0,
          "propertyOrder": 104
        },
        "max_read_registers": {
          "type": "integer",
          "title": "Maximum number of registers in a single bulk read request",
          "minimum": 0,
          "default": 1,
          "propertyOrder": 105
        },
        "guard_interval_us": {
          "type": "integer",
          "title": "Additional delay before each writing to port (us)",
          "minimum": 0,
          "default": 0,
          "propertyOrder": 106
        },
        "frame_timeout_ms": {
          "type": "integer",
          "title": "Frame timeout (ms)",
          "description": "frame_timeout_description",
          "minimum": -1,
          "default": -1,
          "propertyOrder": 107
        },
        "response_timeout_ms": {
          "type": "integer",
          "title": "Response timeout (ms)",
          "description": "response_timeout_description",
          "minimum": -1,
          "default": -1,
          "propertyOrder": 108
        },
        "device_timeout_ms": {
          "type": "integer",
          "title": "Device timeout (ms)",
          "description": "device_timeout_description",
          "minimum": -1,
          "default": 3000,
          "propertyOrder": 109
        },
        "device_max_fail_cycles": {
          "type": "integer",
          "title": "Device max fail cycles",
          "description": "device_max_fail_cycles_desc",
          "minimum": -1,
          "default": 2,
          "propertyOrder": 110
        }
      }
    },
    "setup_cmd": {
      "type": "object",
      "title": "Setup command",
      "headerTemplate": "{{self.title}}",
      "properties": {
        "title": {
          "type": "string",
          "title": "Command name",
          "description": "Used for logging/debugging purposes only",
          "propertyOrder": 1
        },
        "address": {
          "title": "Address",
          "description": "Register index (0-65535 in case of Modbus)",
          "propertyOrder": 2,
          "$ref": "#/definitions/address",
          "options": {
            "keep_oneof_values": false
          }
        },
        "value": {
          "title": "Value",
          "propertyOrder": 3,
          "$ref": "#/definitions/serial_int",
          "options": {
            "keep_oneof_values": false
          }
        }
      },
      "options": {
        "wb": {
          "disable_title": true
        }
      },
      "_format": "grid",
      "required": ["address", "value"]
    },
    "register_channel_common": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "title": "Enabled",
          "default" : true,
          "propertyOrder": 1,
          "_format": "checkbox"
        },
        "name": {
          "$ref": "#/definitions/channel_name",
          "title": "Name", 
          "propertyOrder": 2
        },
        "id": {
          "type": "string",
          "title": "MQTT id of the channel",
          "description": "Used as part of the topic",
          "propertyOrder": 3
        },
        "type": {
          "$ref": "#/definitions/control_type",
          "title": "Type", 
          "propertyOrder": 4
        },
        "reg_type": {
          "$ref": "#/definitions/reg_type",
          "title": "Register type", 
          "propertyOrder": 5
        },
        "units": {
          "$ref": "#/definitions/units",
          "title": "Units",
          "propertyOrder": 8
        },
        "format": {
          "$ref": "#/definitions/format",
          "title": "Format", 
          "propertyOrder": 9
        },
        "max": {
          "title": "Maximum value",
          "$ref": "#/definitions/serial_int",
          "propertyOrder": 10,
          "options": {
            "keep_oneof_values": false
          }
        },
        "scale": {
          "type": "number",
          "title": "Scale (value multiplier)",
          "description": "Value displayed = round((value read * scale) + offset) / round_to) * round_to",
          "default" : 1,
          "propertyOrder": 11,
          "options": {
            "grid_columns": 4,
            "dependencies": {
              "format": ["s16", "u16", "s8", "u8", "s24", "u24", "s32", "u32", "s64", "u64", "bcd8", "bcd16", "bcd24", "bcd32", "float", "double", "char8"]
            }
          }
        },
        "offset": {
          "type": "number",
          "title": "Value offset",
          "description": "Value displayed = round((value read * scale) + offset) / round_to) * round_to",
          "default" : 0,
          "propertyOrder": 12,
          "options": {
            "grid_columns": 4,
            "dependencies": {
              "format": ["s16", "u16", "s8", "u8", "s24", "u24", "s32", "u32", "s64", "u64", "bcd8", "bcd16", "bcd24", "bcd32", "float", "double", "char8"]
            }
          }
        },
        "round_to": {
          "type": "number",
          "title": "Round to",
          "description": "Value displayed = round((value read * scale) + offset) / round_to) * round_to",
          "default" : 1,
          "propertyOrder": 13,
          "minimum": 0
        },
        "readonly": {
          "title": "Read-only",
          "type": "boolean",
          "propertyOrder": 14
        },
        "on_value": {
          // TBD: only use on_value for 'switch' and 'wo-switch' types
          "title": "'On' value",
          "description": "Value corresponding to the 'On' state of the switch",
          "$ref": "#/definitions/serial_int",
          "propertyOrder": 15,
          "options": {
            "keep_oneof_values": false
          }
        },
        "off_value": {
          "title": "'Off' value",
          "description": "Value corresponding to the 'Off' state of the switch",
          "$ref": "#/definitions/serial_int",
          "propertyOrder": 16,
          "options": {
            "keep_oneof_values": false
          }
        },
        "poll_interval": {
          "type": "integer",
          "options": {
            "hidden": true
          }
        },
        "read_period_ms": {
          "type": "integer",
          "title": "Read period (ms)",
          "description" : "read_period_description",
          "minimum": 10,
          "options": {
            "enum_values": [ 100, 200 ],
            "inputAttributes": {
              "placeholder": "in queue order"
            }
          },
          "_format": "edWb",
          "propertyOrder": 16
        },
        "read_rate_limit_ms": {
          "type": "integer",
          "title": "Read rate limit (ms)",
          "description" : "read_rate_limit_description",
          "minimum": 0,
          "default": 1000,
          "propertyOrder": 17
        },
        "error_value": {
          "title": "Error value",
          "description": "Value which should be treated as read error",
          "propertyOrder": 18,
          "oneOf": [
            {
              "title": "decimal or hex",
              "type": "string",
              "pattern": "^(0x[A-Fa-f\\d]+|\\d+)$",
              "options": {
                "inputAttributes": {
                  "placeholder":  "decimal (e.g. 123) or hex (e.g. 0xAF)"
                },
                "patternmessage": "Should be decimal or hex"
              }
            },
            {
              "title": "decimal",
              "type": "integer",
              "minimum": 0,
              "maximum": 4294967295
            }
          ]
        },
        "unsupported_value": {
          "title": "Unsupported register value",
          "description": "Value which should be treated as 'register is unsupported by device'",
          "propertyOrder": 19,
          "type": "string",
          "pattern": "^(0x[A-Fa-f\\d]+)$",
          "options": {
            "inputAttributes": {
              "placeholder":  "hex with prefix '0x'"
            },
            "patternmessage": "Should be hex with prefix '0x'"
          }
        },
        "word_order": {
          "$ref": "#/definitions/word_order",
          "title": "Word order",
          "propertyOrder": 20
        },
        "string_data_size": {
          "type": "integer",
          "title": "String size in characters",
          "description": "string_data_size_description",
          "minimum": 1,
          "default": 1,
          "propertyOrder": 21,
          "options": {
            "dependencies": {
              "format": "string"
            }}
        },
        "consists_of": {
          "not": {},
          "options": { "hidden": true }
        },
        "device_type": {
          "not": {},
          "options": { "hidden": true }
        }
      },
      // FIXME: require "reg_type" and "address" for non-templated devices
      "required": ["name"],
      "defaultProperties": ["name", "type", "reg_type", "format", "scale", "offset", "string_data_size"],
      "_format": "grid",
      "options": {
        "disable_collapse": true,
        "disable_edit_json": true
      }
    },
    "registerChannel": {
      "allOf": [
        { "$ref": "#/definitions/register_channel_common"},
        {
          "properties": {
            "address": {
              "$ref": "#/definitions/address",
              "title": "Address",
              "propertyOrder": 6,
              "options": {
                "keep_oneof_values": false
              }
            }
          },
          "required": ["address"],
          "defaultProperties" : ["address"],
          "not" : {"required": ["write_address"]}
        }
      ]
    },
    "registerChannelSeparateAddress": {
      "title": "Channel with separate r/w addresses",
      "allOf": [
        { "$ref": "#/definitions/register_channel_common"},
        {
          "properties": {
            "address": {
              "title": "Read Address",
              "$ref": "#/definitions/address",
              "propertyOrder": 6,
              "options": {
                "keep_oneof_values": false
              }
            },
            "write_address": {
              "$ref": "#/definitions/write_address",
              "propertyOrder": 7,
              "options": {
                "keep_oneof_values": false
              }
            }
          },
          "required": ["address", "write_address"],
          "defaultProperties": ["address", "write_address"]
        }
      ]
    },
    "registerChannelWriteOnly": {
      "title": "Write Only Channel",
      "allOf": [
        { "$ref": "#/definitions/register_channel_common"},
        {
          "properties": {
            "write_address": {
              "$ref": "#/definitions/write_address",
              "propertyOrder": 6,
              "options": {
                "keep_oneof_values": false
              }
            }
          },
          "required": ["write_address"],
          "defaultProperties": ["write_address"],
          "not" : {"required": ["address"]}
        }
      ]
    },
    "compoundRegisterChannel": {
      "title": "Compound channel",
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "title": "Enabled",
          "default" : true,
          "propertyOrder": 1,
          "_format": "checkbox"
        },
        "name": {
          "$ref": "#/definitions/channel_name",
          "propertyOrder": 2
        },
        "id": {
          "type": "string",
          "title": "MQTT id of the channel",
          "description": "Used as part of the topic",
          "propertyOrder": 3
        },
        "type": {
          "$ref": "#/definitions/control_type",
          "propertyOrder": 4
        },
        "units": {
          "$ref": "#/definitions/units",
          "title": "Units",
          "propertyOrder": 7
        },
        "readonly": {
          "title": "Read-only",
          "type": "boolean",
          "propertyOrder": 8
        },
        "consists_of": {
          "type": "array",
          "title": "A list of subregisters",
          "items": { "$ref": "#/definitions/subreg" },
          "minItems": 1,
          "_format": "table",
          "propertyOrder": 9,
          "options": {
            "disable_collapse": true,
            "wb": {
              "disable_panel": true
            },
            "disable_array_delete_last_row": true,
            "array_controls_top": true
          }
        },
        "poll_interval": {
          "type": "integer",
          "options": {
            "hidden": true
          }
        },
        "read_period_ms": {
          "type": "integer",
          "title": "Read period (ms)",
          "description" : "read_period_description",
          "minimum": 10,
          "options": {
            "enum_values": [ 100, 200 ],
            "inputAttributes": {
              "placeholder": "in queue order"
            }
          },
          "_format": "edWb",
          "propertyOrder": 10
        },
        "read_rate_limit_ms": {
          "type": "integer",
          "title": "Read rate limit (ms)",
          "description" : "read_rate_limit_description",
          "minimum": 0,
          "default": 1000,
          "propertyOrder": 11
        }
      },
      "required": ["name", "consists_of"],
      "defaultProperties": ["name", "consists_of"],
      "options": {
        "disable_collapse": true,
        "disable_edit_json": true
      }
    },
    "common_channel": {
      "headerTemplate": "{{self.name}}",
      "title": "Channel",
      "oneOf": [
        { "$ref": "#/definitions/registerChannel" },
        { "$ref": "#/definitions/compoundRegisterChannel" }
      ],
      "options": {
        "keep_oneof_values": false,
        "wb": {
          "disable_panel": true
        },
        "disable_collapse": true
      },
      "_format": "wb-multiple"
    },
    "common_channel_modbus": {
      "headerTemplate": "{{self.name}}",
      "title": "Channel",
      "oneOf": [
        { "$ref": "#/definitions/registerChannel" },
        { "$ref": "#/definitions/compoundRegisterChannel" },
        { "$ref": "#/definitions/registerChannelSeparateAddress" },
        { "$ref": "#/definitions/registerChannelWriteOnly" }
      ],
      "options": {
        "keep_oneof_values": false,
        "wb": {
          "disable_panel": true
        },
        "disable_collapse": true
      },
      "_format": "wb-multiple"
    },
    "channelSettings": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "title": "Enable poll",
          "default": true,
          "_format": "checkbox"
        },
        "poll_interval": {
          "type": "integer",
          "options": {
            "hidden": true
          }
        },
        "read_period_ms": {
          "type": "integer",
          "title": "Read period (ms)",
          "description" : "read_period_description",
          "minimum": 10,
          "options": {
            "enum_values": [ 100, 200 ],
            "inputAttributes": {
              "placeholder": "in queue order"
            },
            "dependencies": {
              "enabled": true
            }
          },
          "_format": "edWb",
          "propertyOrder": 3
        },
        "read_rate_limit_ms": {
          "type": "integer",
          "title": "Read rate limit (ms)",
          "description" : "read_rate_limit_description",
          "minimum": 0,
          "default": -1,
          "options": {
            "dependencies": {
              "enabled": true
            }
          },
          "_format": "siWb",
          "propertyOrder": 4
        }
      },
      "options": {
        "disable_collapse": true,
        "disable_edit_json": true,
        "disable_properties": true
      }
    },
    "tableChannelSettings": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "options": {
            "hidden": true
          }
        },
        "title": {
          "title": "Parameter",
          "type": "string",
          "_format": "info",
          "propertyOrder": 1
        },
        "mode": {
          "type": "integer",
          "title": "Poll",
          "propertyOrder": 2
        },
        "period": {
          "type": "integer",
          "title": "Period (ms)",
          "minimum": 0,
          "maximum": 172800000,
          "propertyOrder": 3,
          "default": 1000
        }
      },
      "required": ["mode", "name"],
      "options": {
        "remove_empty_properties": true
      }
    },
    "groupsChannel": {
      "type": "object",
      "properties": {
        "mode": {
          "type": "integer",
          "title": "Poll"
        },
        "period": {
          "type": "integer",
          "title": "Period (ms)",
          "minimum": 0,
          "maximum": 172800000,
          "default": 1000
        },
        "channelIndex": {
          "type": "integer",
          "options": {
            "hidden": true
          }
        }
      },
      "required": ["mode", "channelIndex"]
    },
    "subreg": {
      "type": "object",
      "title": "Subregister",
      "properties": {
        "reg_type": {
          "$ref": "#/definitions/reg_type",
          "propertyOrder": 1
        },
        "address": {
          "$ref": "#/definitions/address",
          "propertyOrder": 2,
          "options": {
            "keep_oneof_values": false
          }
        },
        "format": {
          "$ref": "#/definitions/format",
          "propertyOrder": 3
        },
        "scale": {
          "type": "number",
          "title": "Scale (value multiplier)",
          "default" : 1,
          "propertyOrder": 4
        },
        "offset": {
          "type": "number",
          "title": "Value offset",
          "default" : 0,
          "propertyOrder": 5
        },
        "word_order": {
          "$ref": "#/definitions/word_order",
          "propertyOrder": 6
        }
      },
      "required": ["reg_type", "address"],
      "defaultProperties":  ["reg_type", "address"]
    },
    "channel_name": {
      "type": "string",
      "title": "Control name",
      "description": "This name is displayed both in UI and used as part of MQTT topic",
      "minLength": 1
    },
    "control_type": {
      "type": "string",
      "title": "Control type",
      "description": "Defaults to 'switch' for coils and discrete inputs, 'text' for others",
      "enum": [
        "switch", "wo-switch", "pushbutton", "range", "rgb", "text",
        "value", "temperature", "rel_humidity",
        "atmospheric_pressure", "rainfall", "wind_speed", "power",
        "power_consumption", "voltage", "water_flow",
        "water_consumption", "resistance", "concentration",
        "heat_energy", "heat_power",
        "dimmer", "lux", "pressure", "current", "sound_level"
      ],
      "options" : {
        "enum_titles": [
          "switch",
          "wo-switch",
          "pushbutton",
          "range",
          "rgb",
          "text",
          "value",
          "temperature (deprecated, use value with units)",
          "rel_humidity (deprecated, use value with units)",
          "atmospheric_pressure (deprecated, use value with units)",
          "rainfall (deprecated, use value with units)",
          "wind_speed (deprecated, use value with units)",
          "power (deprecated, use value with units)",
          "power_consumption (deprecated, use value with units)",
          "voltage (deprecated, use value with units)",
          "water_flow (deprecated, use value with units)",
          "water_consumption (deprecated, use value with units)",
          "resistance (deprecated, use value with units)",
          "concentration (deprecated, use value with units)",
          "heat_energy (deprecated, use value with units)",
          "heat_power (deprecated, use value with units)",
          "dimmer (deprecated, use value with units)",
          "lux (deprecated, use value with units)",
          "pressure (deprecated, use value with units)",
          "current (deprecated, use value with units)",
          "sound_level (deprecated, use value with units)"
        ]
      }
    },
    "units": {
      "type": "string",
      "_format": "edWb"
    },
    "reg_type": {
      "type": "string",
      "title": "Register type",
      "enum": ["coil", "discrete", "holding", "holding_single", "holding_multi", "input", "direct", "relay", 
               "brightness", "param", "relay_mode", "relay_default", "relay_delay", "energy", "array",
               "param_be", "param_sign_active", "param_sign_reactive", "array12", "default", "param16", 
               "param24", "param32", "power", "freq", "power_factor", "group_single", 
               "temperature", "item_1", "item_2", "item_3", "item_4", "item_5", 
               "alarm", "position", "command", "date", "time",
               // obis_* are deprecated, use item_*, temperature and power_factor
               "obis_cdef", "obis_cdef_pf", "obis_cdef_temp", "obis_cdef_1", "obis_cdef_2", "obis_cdef_3", "obis_cdef_4", "obis_cdef_5"]
    },
    "format": {
      "type": "string",
      "title": "Format",
      "enum": ["s16", "u16", "s8", "u8", "s24", "u24", "s32", "u32", "s64", "u64", "bcd8", "bcd16", "bcd24", "bcd32", "float", "double", "char8", "string"],
      "options": {
        "enum_titles" : [ "Signed 16-bit integer", "Unsigned 16-bit integer", "Signed 8-bit integer", "Unsigned 8-bit integer",
                          "Signed 24-bit integer", "Unsigned 24-bit integer", "Signed 32-bit integer", "Unsigned 32-bit integer",
                          "Signed 64-bit integer", "Unsigned 64-bit integer",
                          "8-bit BCD", "16-bit BCD","24-bit BCD", "32-bit BCD", "IEEE754 32-bit float", "IEEE754 64-bit float (double)",
                          "8-bit ASCII char", "String"]
      }
    },
    "word_order": {
      "type": "string",
      "title": "16-bit Word Order",
      "enum": ["big_endian", "little_endian"],
      "options": {
        "enum_titles" : [ "Big-endian ( [0xAA 0xBB] [0xCC 0xDD] => 0xAABBCCDD)",
                          "Little-endian ( [0xAA 0xBB] [0xCC 0xDD] => 0xCCDDAABB)"]
      },
      "default" : "big_endian"
    },
    "address": {
      "title": "Address",
      "description": "Register index (0-65535 in case of Modbus)",
      "oneOf": [
        {
          "title": "decimal or hex",
          "type": "string",
          "pattern": "^(0x[A-Fa-f\\d]+|\\d+)$",
          "options": {
            "inputAttributes": {
              "placeholder":  "decimal (e.g. 123) or hex (e.g. 0xAF)"
            },
            "patternmessage": "Should be decimal or hex"
          }
        },
        {
          "title": "bits",
          "type": "string",
          "pattern": "^((0x[A-Fa-f\\d]+|\\d+):(\\d+):(\\d+))$",
          "options": {
            "inputAttributes": {
              "placeholder":  "address:offset:bitwidth"
            },
            "patternmessage": "Address should be decimal or hex, offset and bitwidth separated by ':'"
          }
        },
        {
          "title": "decimal",
          "type": "integer"
        }
      ],
      "options": {
        "keep_oneof_values": false
      }
    },
    "write_address": {
      "title": "Write Address",
      "description": "Register index (0-65535 in case of Modbus)",
      "oneOf": [
        {
          "title": "decimal or hex",
          "type": "string",
          "pattern": "^(0x[A-Fa-f\\d]+|\\d+)$",
          "options": {
            "inputAttributes": {
              "placeholder":  "decimal (e.g. 123) or hex (e.g. 0xAF)"
            },
            "patternmessage": "Should be decimal or hex"
          }
        },
        {
          "title": "decimal",
          "type": "integer"
        }
      ],
      "options": {
        "keep_oneof_values": false
      }
    },
    "serial_int": {
      "oneOf": [
        {
          "title": "decimal or hex",
          "type": "string",
          "pattern": "^(0x[A-Fa-f\\d]+|\\d+)$",
          "options": {
            "patternmessage": "Should be decimal or hex"
          }
        },
        {
          "title": "decimal",
          "type": "integer"
        }
      ]
    },

    "no_setup": {
      "properties": {
        "setup": {
          "not": {},
          "options": { "hidden": true }
        }
      }
    },

    "dlms_address": {
      "properties": {
        "address": {
          "title": "OBIS code",
          "type": "string",
          "pattern": "^(\\d+\\.\\d+\\.\\d+\\.\\d+\\.\\d+\\.\\d+)$",
          "propertyOrder": 6,
          "options": {
            "inputAttributes": {
              "placeholder":  "X.X.X.X.X.X"
            },
            "patternmessage": "OBIS code should contain 6 numbers separated by dots (X.X.X.X.X.X)"
          }
        }
      },
      "required": ["address"]
    },
    "dlms_channel": {
      "headerTemplate": "{{self.name}}",
      "title": "Channel",
      "allOf": [
        { "$ref": "#/definitions/register_channel_common"},
        { "$ref": "#/definitions/dlms_address" }
      ],
      "_format": "wb-object",
      "options" : {
        "wb": {
          "disable_panel": true
        }
      }
    },
    "dlms_channels": {
      "properties": {
        "channels": {
          "type": "array",
          "title": "Custom channels",
          "items": { "$ref": "#/definitions/dlms_channel" },
          "propertyOrder": 99,
          "_format": "tabs",
          "options": {
            "disable_array_delete_last_row": true
          }
        }
      }
    },
    "dlms_device_properties": {
      "properties": {
        "dlms_client_address": {
          "title": "DLMS client address",
          "description": "16 - public client (default), 32 - SPODES measurements reader, 48 - SPODES configurator",
          "type": "integer",
          "minimum": 0,
          "default": 16,
          "propertyOrder": 9
        },
        "dlms_auth": {
          "title": "DLMS authentication mode",
          "type": "integer",
          "enum": [0, 1, 2, 3, 4, 5, 6, 7],
          "options": {
            "enum_titles": [
              "no authentication",
              "low",
              "high",
              "high, password is hashed with MD5",
              "high, password is hashed with SHA1",
              "high, password is hashed with GMAC",
              "high, password is hashed with SHA-256",
              "high, password is hashed with ECDSA"
            ]
          },
          "default": 0,
          "propertyOrder": 12
        },
        "dlms_interface": {
          "title": "DLMS interface",
          "type": "integer",
          "enum": [0, 1, 2, 3, 5, 6, 7, 8, 9],
          "options": {
            "enum_titles": [
              "HDLC",
              "TCP/IP or UDP wrapper, can be used with devices that support IEC 62056-47",
              "plain PDU",
              "Wireless M-Bus",
              "PLC",
              "PLC HDLC",
              "LowPower Wide Area Networks (LPWAN)",
              "Wi-SUN FAN mesh network",
              "OFDM PLC PRIME"
            ]
          },
          "default": 0,
          "propertyOrder": 13
        }
      }
    },
    "dlms_device": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/dlms_device_properties" },
        { "$ref": "#/definitions/dlms_channels" },
        { "$ref": "#/definitions/slave_id" },
        { "$ref": "#/definitions/no_setup" }
      ]
    },
    "dlms_device_no_channels": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/dlms_device_properties" },
        { "$ref": "#/definitions/slave_id" },
        { "$ref": "#/definitions/no_setup" }
      ]
    },

    "somfy_device_properties": {
      "properties": {
        "node_type": {
          "title": "Motor type",
          "type": "integer",
          "enum": [2, 5, 6, 7, 8, 9],
          "options": {
            "enum_titles": [
              "Sonesse 30 DC",
              "RTS transmitter",
              "Glydea",
              "Sonesse 50 AC",
              "Sonesse 50 DC",
              "Sonesse 40 AC"
            ]
          },
          "default": 2,
          "propertyOrder": 12
        }
      }
    },
    "somfy_device_no_channels": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/somfy_device_properties" },
        { "$ref": "#/definitions/slave_id" },
        { "$ref": "#/definitions/no_setup" }
      ]
    },

    "string_address": {
      "properties": {
        "address": {
          "title": "Parameter",
          "type": "string",
          "propertyOrder": 6
        }
      },
      "required": ["address"]
    },
    "channel_with_string_address": {
      "headerTemplate": "{{self.name}}",
      "title": "Channel",
      "allOf": [
        { "$ref": "#/definitions/register_channel_common"},
        { "$ref": "#/definitions/string_address" }
      ],
      "_format": "wb-object",
      "options" : {
        "wb": {
          "disable_panel": true
        }
      }
    },
    "channels_with_string_addresses": {
      "properties": {
        "channels": {
          "type": "array",
          "title": "Custom channels",
          "items": { "$ref": "#/definitions/channel_with_string_address" },
          "propertyOrder": 99,
          "_format": "tabs",
          "options": {
            "disable_array_delete_last_row": true
          }
        }
      }
    },

    "common_channels": {
      "properties": {
        "channels": {
          "type": "array",
          "title": "Custom channels",
          "items": { "$ref": "#/definitions/common_channel" },
          "propertyOrder": 99,
          "_format": "tabs",
          "options": {
            "disable_array_delete_last_row": true
          }
        }
      }
    },
    "common_channels_modbus": {
      "properties": {
        "channels": {
          "type": "array",
          "title": "Custom channels",
          "items": { "$ref": "#/definitions/common_channel_modbus" },
          "propertyOrder": 99,
          "_format": "tabs",
          "options": {
            "disable_array_delete_last_row": true
          }
        }
      }
    },
    "common_setup": {
      "properties": {
        "setup": {
          "type": "array",
          "title": "Custom setup commands",
          "items": { "$ref": "#/definitions/setup_cmd" },
          "propertyOrder": 100,
          "_format": "tabs",
          "options": {
            "disable_array_delete_last_row": true
          }
        }
      }
    },

    "simple_device": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/no_setup" },
        { "$ref": "#/definitions/common_channels" },
        { "$ref": "#/definitions/slave_id" }
      ]
    },
    "simple_device_no_channels": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/slave_id" },
        { "$ref": "#/definitions/no_setup" }
      ]
    },

    "enrgomera_iec_mode_c_device": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/no_setup" },
        { "$ref": "#/definitions/channels_with_string_addresses" },
        { "$ref": "#/definitions/slave_id_broadcast" }
      ]
    },
    "enrgomera_iec_mode_c_device_no_channels": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/no_setup" },
        { "$ref": "#/definitions/slave_id_broadcast" }
      ]
    },

    "simple_device_with_broadcast": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/no_setup" },
        { "$ref": "#/definitions/common_channels" },
        { "$ref": "#/definitions/slave_id_broadcast" }
      ]
    },
    "simple_device_with_broadcast_no_channels": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/no_setup" },
        { "$ref": "#/definitions/slave_id_broadcast" }
      ]
    },

    "simple_device_with_setup_no_channels": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/common_setup" },
        { "$ref": "#/definitions/slave_id" }
      ]
    },
    "simple_device_with_setup": {
      "allOf": [
        { "$ref": "#/definitions/deviceProperties" },
        { "$ref": "#/definitions/common_channels" },
        { "$ref": "#/definitions/common_setup" },
        { "$ref": "#/definitions/slave_id" }
      ]
    },

    "device": {
      "title": "Device",
      "headerTemplate": "{{self.name}} {{self.slave_id}}",
      "oneOf": [
        {
          "title" : "Unknown device",
          "type" : "object",
          "_format": "unknown-device",
          "options": {
            "wb": {
                "hide_from_selection": true,
                "group": "g-custom"
            }
          },
          "properties": {
            "device_type": {
              "type": "string",
              "enum": [ "unknown" ]
            },
            "value": {
              "type": "object"
            }
          },
          "required": [ "device_type", "value" ]
        },
        {
          "title": "Custom DLMS device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/dlms_device_properties" },
            { "$ref": "#/definitions/dlms_channels" },
            { "$ref": "#/definitions/slave_id" },
            { "$ref": "#/definitions/no_setup" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["dlms"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom UNIEL device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id" },
            { "$ref": "#/definitions/no_setup" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["uniel"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Milur device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["milur"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Mercury 230 device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id_broadcast" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["mercury230"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom IVTM device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["ivtm"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom S2K device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["s2k"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Pulsar device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["pulsar"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Mercury 200 device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["mercury200"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom LLS device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["lls"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Neva device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id_broadcast" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["neva"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Energomera device with IEC 61107 fast read support",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/slave_id_broadcast" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["energomera_iec"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Energomera device with IEC 61107 Mode C protocol",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/no_setup" },
            { "$ref": "#/definitions/channels_with_string_addresses" },
            { "$ref": "#/definitions/slave_id_broadcast" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["energomera_iec_mode_c"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Modbus device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/common_channels_modbus" },
            { "$ref": "#/definitions/common_setup" },
            { "$ref": "#/definitions/slave_id" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["modbus"],
              "default": "modbus",
              "options": {
                "hidden": true
              }
            },
            "device_type": {
              "not": {},
              "options": { "hidden": true }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        },
        {
          "title": "Custom Modbus IO device",
          "allOf": [
            { "$ref": "#/definitions/deviceProperties" },
            { "$ref": "#/definitions/common_channels" },
            { "$ref": "#/definitions/common_setup" },
            { "$ref": "#/definitions/slave_id" }
          ],
          "properties": {
            "protocol": {
              "type": "string",
              "enum": ["modbus_io"],
              "options": {
                "hidden": true
              }
            }
          },
          "options": {
            "wb": {
              "group": "g-custom"
            }
          },
          "required": ["protocol", "slave_id"],
          "defaultProperties": ["slave_id", "channels", "protocol"]
        }
      ],
      "options": {
        "disable_edit_json": true,
        "keep_oneof_values": false,
        "wb": {
          "disable_panel": true,
          "hidden_msg": "deprecated template",
          "hidden_notice": "hidden_template_notice",
          "groups": ["g-wb", "g-wb-old", "g-adapter", "g-climate-sensor", "g-level", "g-dimmer", "g-air-conditioning", 
                     "g-ventilation", "g-refrigeration", "g-io", "g-relay", "g-curtain", "g-control-panel",
                     "g-water-meter", "g-heat-meter", "g-power-meter", "g-thermostat", "g-motor-control",
                     "g-custom"]
        }
      },
      "_format": "wb-multiple"
    }

  },

  "properties": {
    "debug": {
      "type": "boolean",
      "title": "Enable debug logging",
      "default": false,
      "_format": "checkbox",
      "propertyOrder": 1
    },
    "ports": {
      "type": "array",
      "title": "List of ports",
      "items": { "$ref": "#/definitions/port" },
      "minItems": 1,
      "_format": "tabs",
      "propertyOrder": 2,
      "options" : {
          "disable_collapse" : true,
          "disable_array_delete_last_row": true,
          "disable_array_reorder": true
      }
    },
    "max_unchanged_interval" : {
      "type" : "integer",
      "title" : "Unchanged value posting interval",
      "description" : "max_unchanged_interval_desc",
      "default" : -1,
      "propertyOrder" : 3
    }
  },

  "required": ["ports"],

  "options": {
    "disable_edit_json": true
  },

  "configFile": {
    "path": "/etc/wb-mqtt-serial.conf",
    "service": "wb-mqtt-serial",
    "toJSON": ["wb-mqtt-serial", "-j"],
    "fromJSON": ["wb-mqtt-serial", "-J"],
    "validate": false
  },

  "translations": {
    "en": {
      "read_rate_limit_description": "This option is deprecated, use read period of channels instead",
      "read_period_description": "This option specifies the desired period between two consecutive reads of the channel. Short periods may not be maintained due to port bandwidth limitations",
      "guard_interval_description": "Specifies the delay in microseconds before writing to the port",
      "connection_timeout_description": "Used for disconnect detection. If not set, the default timeout (5000ms) is used. Value -1 disables TCP reconnect. Zero means instant timeout.",
      "connection_max_fail_description": "Defines number of driver cycles with all devices being disconnected before resetting connection. Default value is 2. Value -1 disables TCP reconnect. Zero means instant timeout.",
      "port_header_template": "{{if self.port_type==\"serial\"}}Serial port{{endif}}{{if self.port_type==undefined}}Serial port{{endif}}{{if self.port_type==\"tcp\"}}Port TCP{{endif}}{{if self.port_type==\"modbus tcp\"}}Port MODBUS TCP{{endif}} {{self.path}}{{self.address}} {{self.port}}",
      "broadcast_description": "Requests are sent without specifying exact id of the device. Use the mode if only one device is connected",
      "frame_timeout_description": "Specifies minimum inter-frame delay. For some protocols this value is used to split incoming data into frames.",
      "response_timeout_description": "Specifies maximum device's response time. Zero means no timeout. If not set, the default timeout (500ms) is used. If port's appropriate parameter is bigger, this one is overwritten.",
      "device_timeout_description": "Specifies timeout for device connection. If not set, default value 3000ms is used. Value -1 disables device reconnect. Zero means instant timeout.",
      "device_max_fail_cycles_desc": "Defines number of device polling cycles with all failed registers before marking device as disconnected. Default value is 2. Value -1 disables device reconnect. Zero means instant timeout.",
      "max_unchanged_interval_desc": "Specifies the maximum interval in seconds between posting the same values to message queue. Zero means the values are posted to the queue every time they read from the device. By default, the values are only reported on change. Negative value means default behavior.",
      "string_data_size_description": "For the modbus protocol, strings are read one character per register from the low byte. The parameter specifies the number of characters",
      "hidden_template_notice": "Device template is deprecated, use newer version",
      "g-wb": "Wiren Board devices",
      "g-wb-old": "Deprecated Wiren Board devices",
      "g-adapter": "Protocol adapters",
      "g-climate-sensor": "Climate sensors",
      "g-level": "Level sensors",
      "g-dimmer": "Dimmers",
      "g-air-conditioning": "Air conditioning equipment",
      "g-ventilation": "Ventilation equipment",
      "g-refrigeration": "Refrigeration equipment",
      "g-io": "IO modules",
      "g-relay": "Relays",
      "g-curtain": "Curtain motors",
      "g-control-panel": "Control panels",
      "g-water-meter": "Water meters",
      "g-heat-meter": "Heat meters",
      "g-power-meter": "Energy meters",
      "g-thermostat": "Thermostats",
      "g-motor-control": "Motor controllers",
      "g-custom": "Custom devices"
    },
    "ru": {
      "Serial Device Driver Configuration": "  serial-",
      "Configuration of devices connected to serial ports (RS-485, TCP, UART)": " ,     (RS-485, TCP, UART)",  
      "Enable port": " ",
      "Response timeout (ms)": "  ()",
      "Zero means no timeout. If not set, the default timeout (500ms) is used.": " -  .    500",
      "Guard interval (us)": "     ()",
      "guard_interval_description": "",
      "Read period (ms)": "  ()",
      "read_period_description": "     .       -    .",
      "Devices attached to the port": ",   ",
      "Serial port": " ",
      "Port type": " ",
      "serial": "",
      "Path to device": "  ",
      "Baud rate": " ",
      "Parity": " ",
      "Data bits": "  ",
      "Stop bits": " ",
      "IPv4 address or hostname of device": "IPv4     ",
      "TCP port number": " TCP ",
      "Connection timeout (ms)": "  ()",
      "connection_timeout_description": "    .   5000. -1      .",
      "Connection max fail cycles": "   ",
      "connection_max_fail_description": "       ,      .   2. -1  .",
      "Serial over TCP": "   TCP",
      "port_header_template": "{{if self.port_type==\"serial\"}} {{endif}}{{if self.port_type==undefined}} {{endif}}{{if self.port_type==\"tcp\"}} TCP{{endif}}{{if self.port_type==\"modbus tcp\"}} MODBUS TCP{{endif}} {{self.path}}{{self.address}} {{self.port}}",
      "Port": "",
      "Slave id of the device": " ",
      "decimal or hex": "   ",
      "decimal (e.g. 123) or hex (e.g. 0xAF)": " (, 123)   (, 0xAF)",
      "Should be decimal or hex": "      ",
      "decimal": " ",
      "Slave id of the device or broadcast mode": "    ",
      "decimal or hex slave id": "     ",
      "decimal slave id": "   ",
      "broadcast": " ",
      "broadcast_description": "      .   ,     ",
      "Device name to be displayed in UI": "",
      "Device name": " ",
      "Enable device": " ",
      "MQTT id of the device": "   MQTT",
      "Used as part of the topic": "     MQTT",
      "Password as a list of bytes": "    ",
      "Access level": " ",
      "Max dummy read register count": "    ",
      "Max dummy read bit count": "    ",
      "Maximum number of registers in a single bulk read request": "  ,    ",
      "Additional delay before each writing to port (us)": "      ()",
      "Frame timeout (ms)": "   ()",
      "Device timeout (ms)": "   ()",
      "Device max fail cycles": "    ",
      "frame_timeout_description": "    .          .",
      "response_timeout_description": "    .   500 .     ,    .",
      "device_timeout_description": "   .   3000 .  ,   -1.",
      "device_max_fail_cycles_desc": "         .   2.  ,   -1.",
      "Setup command": " ",
      "Command name": " ",
      "Used for logging/debugging purposes only": "    ",
      "Address": "",
      "Read Address" : "  ",
      "Write Address" : "  ",
      "Register index (0-65535 in case of Modbus)": "  (0-65535  Modbus)",
      "Value": "",
      "Enabled": "",
      "MQTT id of the channel": "    MQTT",
      "Scale (value multiplier)": "",
      "Value offset": "",
      "Round to": "",
      "Read-only": "  ",
      "'On' value": "  ",
      "Value corresponding to the 'On' state of the switch": ",     ",
      "'Off' value": "  ",
      "Value corresponding to the 'Off' state of the switch": ",     ",
      "Value displayed = round((value read * scale) + offset) / round_to) * round_to": "  = ((  * ) + ) / ) * ",
      "Error value": " ",
      "Value which should be treated as read error": ",      ",
      "Unsupported register value": "  ",
      "Value which should be treated as 'register is unsupported by device'": "   ,      ",
      "Compound channel": " ",
      "A list of subregisters": "  ",
      "Channel": "",
      "Channels": "",
      "Channel with separate r/w addresses": "      ",
      "Write Only Channel": "   ",
      "Enable poll": "",
      "Parameter": "",
      "Subregister": " ",
      "Control name": " ",
      "This name is displayed both in UI and used as part of MQTT topic": "         MQTT",
      "Control type": " ",
      "Defaults to 'switch' for coils and discrete inputs, 'text' for others": "   switch     ,   - ",
      "Register type": " ",
      "Format": "",
      "Signed 16-bit integer": "16-   ",
      "Unsigned 16-bit integer": "16-   ", 
      "Signed 8-bit integer": "8-   ",
      "Unsigned 8-bit integer": "8-   ",
      "Signed 24-bit integer": "24-   ",
      "Unsigned 24-bit integer": "24-   ",
      "Signed 32-bit integer": "32-   ",
      "Unsigned 32-bit integer": "32-   ",
      "Signed 64-bit integer": "64-   ",
      "Unsigned 64-bit integer": "64-   ",
      "IEEE754 32-bit float": "32-     (IEEE754)",
      "IEEE754 64-bit float (double)": "64-     (IEEE754)",
      "8-bit ASCII char": "8-  ASCII",
      "16-bit Word Order": " 16- ",
      "bits": "",
      "address:offset:bitwidth": ":: ",
      "Address should be decimal or hex, offset and bitwidth separated by ':'": "        .      ",
      "OBIS code": " OBIS",
      "OBIS code should contain 6 numbers separated by dots (X.X.X.X.X.X)": " OBIS    6 ,  ",
      "Custom channels": ",  ",
      "DLMS client address": "  DLMS",
      "16 - public client (default), 32 - SPODES measurements reader, 48 - SPODES configurator": "16 -   ( ), 32 -   , 48 -  ", 
      "Unchanged value posting interval": "   ",
      "max_unchanged_interval_desc": "   ,    .         .       .      ",
      "List of ports": " ",
      "Enable debug logging": "  ",
      "Custom Modbus IO device": "   Modbus IO",
      "Custom Modbus device": "   Modbus",
      "Custom Energomera device with IEC 61107 Mode C protocol": "    IEC 61107 Mode C",
      "Custom Energomera device with IEC 61107 fast read support": "        IEC 61107",
      "Custom Neva device": " ",
      "Custom LLS device": "   LLS",
      "Custom Mercury 200 device": "     200",
      "Custom Pulsar device": "   ",
      "Custom S2K device": "   2000",
      "Custom IVTM device": "   ",
      "Custom Mercury 230 device": "     230",
      "Custom Milur device": "    ",
      "Custom UNIEL device": "   UNIEL",
      "Custom DLMS device": "   DLMS/",
      "Custom setup commands": " ",
      "Motor type": " ",
      "DLMS authentication mode": "  DLMS",
      "no authentication": " ",
      "low": "",
      "high": "",
      "high, password is hashed with MD5": "   MD5",
      "high, password is hashed with SHA1": "   SHA1",
      "high, password is hashed with GMAC": "   GMAC",
      "high, password is hashed with SHA-256": "   SHA-256",
      "high, password is hashed with ECDSA": "   ECDSA",
      "DLMS interface": " DLMS",
      "TCP/IP or UDP wrapper, can be used with devices that support IEC 62056-47": "TCP/IP  UDP,    ,  IEC 62056-47",
      "plain PDU": "PDU  ",
      "Wi-SUN FAN mesh network": "Wi-SUN FAN mesh-",
      "Device": "",
      "Byte": "",
      "inherited from device and port": "    ",
      "Word order": " ",
      "Name": "",
      "Type": "",
      "Maximum value": " ",
      "Unknown device": " ",
      "Read rate limit (ms)": "   ()",
      "Units": " ",
      "Poll": "",
      "Period (ms)": " ()",
      "in queue order": "  ",
      "200 ms": "200 ",
      "100 ms": "100 ",
      "custom period": " ",
      "do not read": " ",
      "read_rate_limit_description": "       ,      ",
      "not faster than (deprecated)": "     ( )",
      "String size in characters": "   ",
      "String": "",
      "string_data_size_description": "  modbus          .    ",
      "deprecated template": " ",
      "hidden_template_notice": "  ,    ",
      "g-wb": " Wiren Board",
      "g-wb-old": "  Wiren Board",
      "g-adapter": " ",
      "g-climate-sensor": " ",
      "g-level": " ",
      "g-dimmer": "",
      "g-air-conditioning": "",
      "g-ventilation": "   ",
      "g-refrigeration": "  ",
      "g-io": " -",
      "g-relay": " ",
      "g-curtain": "  /",
      "g-control-panel": "  ",
      "g-water-meter": " ",
      "g-heat-meter": " ",
      "g-power-meter": " ",
      "g-thermostat": "",
      "g-motor-control": "  ( )",
      "g-custom": " "
    }
  }
}
